{% from "munimap/macros/layerswitcher.html" import layers_group_item, layer_group_item %}

{% if layers_def['overlays'] | length > 0 %}
  <div ui-sortable="sortableGroups" ng-model="overlayLayers">
    <div class="overlay-item" ng-repeat="group in overlayLayers" ng-show="group.displayInLayerswitcher !== false && group !== undefined">
      <div class="group-item catalog-layer-title layer-line" ng-show="group.catalogLayer == true && group.groupLayer == false" ng-class="{'inactive': !group.getVisible()}">
        <div>
          <a title="Metadaten" ng-if="group.metadataUrl && hideMetadata == false" 
              target="_blank" ng-href="{{ group.metadataUrl }}">
            <span class="glyphicon glyphicon-info-sign"></span>                    
          </a>
          <span ng-if="!group.metadataUrl && hideMetadata == false" class="glyphicon glyphicon-none float-left"></span>
          <span class="pointer layer-title" ng-click="toggleLayerVisibleByName(group.name)">
            {{ group.catalog.title }}
          </span>
        </div>
        <i title="Layer entfernen" class="glyphicon glyphicon-remove float-right pointer" ng-click="removeLayer(group)"></i>
      </div> 

      <div class="group-item" ng-show="group.groupLayer == true && group.options.showGroup === true"
          ng-class="{'inactive': !groupIsVisibleByName(group.name)}">
        <span class="pointer float-left"
            ng-class="{'open-layer-group': group.options.collapsed, 
            'close-layer-group': !group.options.collapsed}"
            ng-click="group.options.collapsed=!group.options.collapsed">
        </span>
        <div class="layer-line" ng-class="{'title-wrapper-group': !group.options.metadataUrl && hideMetadata == false }">
          <div>
            <span ng-if="!group.options.metadataUrl && hideMetadata == false" class="glyphicon glyphicon-none float-left"></span>
            <a title="Metadaten" ng-if="group.options.metadataUrl && hideMetadata == false" 
                class="metadata float-left" target="_blank" ng-href="{{ group.options.metadataUrl }}">
              <span class="glyphicon glyphicon-info-sign"></span>
            </a>
            <span class="layer-title" ng-click="toggleGroupVisibleByName(group.name)">
              {{ group.title }}
            </span>
          </div>
          <div>
            <i title="Transparenz einstellen" ng-click="group.toggleConfig()" 
                class="toggle-layer-conf glyphicon glyphicon-adjust pointer {{ group.showConfig ? 'active' : '' }}">
            </i>
            <i title="Gruppe entfernen" class="glyphicon glyphicon-remove pointer" 
                ng-if="removeLayerEnabled" ng-click="removeLayer(group)"></i>
            <dialog ng-if="group.showConfig" class="layer-conf slide-top" ng-blur="group.toggleConfig()">
              <header>
                {{ group.title }}
                <button title="SchlieÃŸen" class="glyphicon glyphicon-remove pointer" ng-click="group.toggleConfig()"></button>
              </header>
              <div class="transparency-slider">
                <label for="transparency-slider">
                  Transparenz: {{ (group.transparency() * 100).toFixed(0) }}%
                </label>
                <input id="transparency-slider" type="range" min="0" max="1" step="0.01"
                    ng-model="group.transparency" ng-model-options="{getterSetter: true}"/>
              </div>
            </dialog>
          </div>
        </div>
        <div ui-sortable="sortableLayer" ng-model=group.layers>
          <div class="group-layers-container" ng-repeat="layer in group.layers" 
              ng-if="layer.displayInLayerswitcher !== false" 
              ng-show="!group.options.collapsed"
              ng-class="{'inactive': !layerIsVisibleByName(layer.name)}">
            <a ng-if="layer.metadataUrl && hideMetadata == false" target="_blank" ng-href="{{ layer.metadataUrl }}" title="Metadaten">
                <span class="glyphicon glyphicon-info-sign"></span>
            </a>
            <span ng-if="!layer.metadataUrl && hideMetadata == false" class="glyphicon glyphicon-none"></span>                          
            <div class="layer-title child-title" ng-click="toggleLayerVisibleByName(layer.name)">
              <span>{{ layer.title }}</span>
            </div>
            <!-- <i title="Layer entfernen" class="glyphicon glyphicon-remove pull-right pointer" ng-if="removeLayerEnabled"
                ng-click="removeLayer(layer)"></i> -->
          </div>
        </div>
      </div>

      <div class="group-item no-group-layer-title" ng-show="group.groupLayer == true && group.options.showGroup === false"
         ng-class="{'inactive': !groupIsVisibleByName(group.name)}">
          <div class="no-group-layers-container" ng-repeat="layer in group.layers" 
            ng-if="layer.displayInLayerswitcher !== false" 
            ng-class="{'inactive': !layerIsVisibleByName(layer.name)}">

            <a class="float-left" ng-if="group.options.metadataUrl && hideMetadata == false" target="_blank" ng-href="{{ group.options.metadataUrl }}">
              <span class="glyphicon glyphicon-info-sign"></span>                    
            </a>
            <span ng-if="!group.options.metadataUrl && hideMetadata == false" class="glyphicon glyphicon-none float-left"></span>    
            <div>
              <span class="layer-title"
                ng-click="toggleLayerVisibleByName(layer.name)">
                  {{ layer.title }}
              </span>
              <i class="glyphicon glyphicon-remove float-right pointer" ng-if="removeLayerEnabled"
                  ng-click="removeLayer(layer)"></i>
            </div>
          </div>
      </div>
    </div>
  </div>
{% else %}
  <div class="overlay-item">
      {$ _('No overlay layers available') $}
  </div>
{% endif %}


                
